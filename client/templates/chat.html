<template name="chat">
  <div class="row">
    <div class="conversation-wrap">
      {{#if loggedIn}}
        <form role="form" id="send-message">
          <div class="form-group">
            <input type="text" name="message" class="form-control" placeholder="Your message" id="message">
          </div>
        </form>
      {{else}}
        <form role="form" id="login">
          <div class="form-group">
            <input type="text" class="form-control" id="username" placeholder="Username" name="username" required>
          </div>
          <div class="form-group">
            <input type="password" class="form-control" id="password" placeholder="Password" name="password" required>
          </div>
          <button type="submit" class="btn btn-block btn-primary">Login</button>
        </form>
      {{/if}}
      
      {{#each messages}}
        <div class="media conversation">
          <a class="pull-left" href="https://www.tradingview.com/u/{{username}}" target="_blank">
            <img class="media-object" style="width: 39px; height: 39px;" src="{{user_pic}}">
          </a>
          
          <div class="media-body">
            <h6 class="media-heading"><a href="#" class="username">{{username}}</a> <small>{{time}}</small></h6>
            <p>{{{formattedText}}}</p>
            {{#if chartAttached}}
              <a href="{{meta.url}}" target="_blank"><img src="{{meta.preview_url}}" alt="Chart"></a>
            {{/if}}
          </div>
        </div>
      {{/each}}
    </div>
  </div>
</template>